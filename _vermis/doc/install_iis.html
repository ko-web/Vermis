<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Install Vermis on Microsoft IIS Web Server</title>
</head>
<body>

<h2>Installing Vermis on Microsoft IIS Web Server on Windows 7</h2>

<h3>1. Turn on IIS web server</h3>

Go to the Control Panel > Programs > Turn Windows features on or off<br/>
<br />
Select:
<ul>
    <li>Internet Information Services</li>
    <li>World Wide Web Services
        <ul>
            <li>Aplication Development Features
                <ul>
                    <li>CGI</li>
                    <li>ISAPI Extensions</li>
                    <li>ISAPI Filters</li>
                </ul>
            </li>
            <li>Common HTTP Features</li>
        </ul>
    </li>
</ul>

Next open your browser and check if you have the IIS default page when you hit <a href="http://localhost">http://localhost</a>
<br />
<i>If you're using Skype remember to turn it off because it uses port 80 which is needed by IIS.</i>


<h3>2. Install PHP</h3>
Get the PHP for Windows from <a href="http://windows.php.net/download/">http://windows.php.net/download/</a><br />
Download version 5.2.x or higher (i.e. 5.3.x). I have downloaded this zip package: 
<a href="http://windows.php.net/downloads/releases/php-5.3.3-Win32-VC9-x86.zip">http://windows.php.net/downloads/releases/php-5.3.3-Win32-VC9-x86.zip</a><br />
Unpack it to C:\php, next copy php.ini-development to C:\php\php.ini and make sure that you have following 
lines (or simmilar) in [PHP] section:

<pre><code>
[PHP]
fastcgi.impersonate = 1
cgi.fix_pathinfo = 0
cgi.force_redirect = 0
open_basedir = "C:\Windows\TEMP\;C:/inetpub/wwwroot/"
extension_dir = "C:/php/ext/"
error_log = "C:/php_error.log"
short_open_tag = On

[Session]
session.save_path = "C:\Windows\TEMP\"
</code></pre>


Next go to Control Panel > System and Security > Administrative Tools and click IIS Manager.<br />
<br />
Open „Handler Mappings” and click on „Add Module Mapping...”<br />
Create a new module mapping for php by filling form in popup window:<br />
<p>
    Request path:       *.php
    Module:     FastCgiModule
    Executable:     C:\php\php-cgi.exe
    Name:           FastCGI
</p>
Restart IIS server and go to the C:\inetpub\wwwroot <br />
Next create a new file called phpinfo.php and put following content inside:<br />
<pre><code>
    &lt;?php phpinfo();
</code></pre>
Open your browser and go to this location <a href="http://localhost/phpinfo.php">http://localhost/phpinfo.php</a> and check out if you have a PHP information page.

<h3>3. Install ISAPI_Rewrite3</h3>

Download the latest lite version of ISAPI_Rewrite3 from this site: <a href="http://www.helicontech.com/isapi_rewrite/">http://www.helicontech.com/isapi_rewrite/</a><br />
And install it.<br />


<h3>4. Install MySQL</h3>

Download the latest MySQL server and install it
<a href="http://dev.mysql.com/downloads/mysql/">http://dev.mysql.com/downloads/mysql/</a>


<h3>5. Install Vermis</h3>

Get the latest Vermis package from <a href="http://vermis.ognisco.com/download">http://vermis.ognisco.com/download</a><br /> 
Unpack it into C:\inetpub\wwwroot\vermis<br />
<br />
Next create a new database called vermis.
<br />
You can do this by typing mysql query:
<pre><code>
CREATE DATABASE vermis;
</code></pre>

and next create user vermis identified by password vermis which has access to the vermis database.<br />
<pre><code>
GRANT ALL PRIVILEGES ON vermis.* to vermis@localhost identified by 'vermis';
</code></pre>
Next you need to load database structure from database.sql file into your new vermis database.<br />
<br />
Next go to C:\inetpub\wwwroot\vermis\config and copy sample.config.php to config.php<br />
Open it and edit:

<pre><code>
&lt;?php

return array(

    'environment' => 'prod',

    'prod' => array(
        'baseHost'                  => 'http://localhost',
        'baseUri'                   => '/',
        'locale'                    => 'en_US',
        'uploadMaxSize'             => 1048576, // 1MB
        'dateFormat'                => 'Y-m-d H:i:s',

        'mailer' => array(
            'enable'        => false,
            'from'          => 'no-reply@your-domain.tld',
            'titleHeader'   => 'Vermis'
        ),

        'database' => array(
            'driver'    => 'mysql',
            'host'      => 'localhost',
            'name'      => 'vermis',
            'user'      => 'myuser',
            'password'  => 'mypassword',
            'port'      => 3306,
            'debug'     => false
        ),
        
        'throwExceptions'   => true
    ) 

);
</code></pre>

<h3>6. Adjust IIS settings for Vermis</h3>

Go to Control Panel > System and Security > Administrative Tools and click IIS Manager<br />
On the left side you should have : Sites > Default Web Site click it and edit by hiting 
„Basic Settings...” from a menu in the right column of the manager.<br />
<p>
    Physical path:      C:\inetput\wwwroot\vermis
</p>
Restart your server and check if you see this page: http://localhost/index.php<br />

<h3>7. Adjut ISAPI_Rewrite3 for Vermis (rewriting)</h3>

Go to your ISAPI_Rewrite3 installation directory (C:\Program Files\Helicon\ISAPI_Rewrite3)<br />
Edit httpd.ini and copy there this content:
<pre><code>
[ISAPI_Rewrite]

RewriteEngine On
RewriteBase /
RepeatLimit 20
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule !\.(js|ico|gif|jpg|jpeg|png|css|htm|html|htc)$ index.php
</code></pre>
Restart your IIS server!

<h3>8. DONE!</h3>

    Go to <a href="http://localhost/">http://localhost/</a> if you see Vermis then it works :)

<h3>9. Possible problems</h3>

The biggest problem that I had on Windows7 was to force it to unset the „ReadOnly” 
attribute from wwwroot directory, because Vermis needs a permission to write in these directories. <br />
If you have the same problem you can find some help here: <br />
<a href="http://itexpertvoice.com/home/fixing-the-windows-7-read-only-folder-blues/">http://itexpertvoice.com/home/fixing-the-windows-7-read-only-folder-blues/</a>

<div style="font-size:10px; padding:2em; text-align:center;">
Copyright &copy; 2011 <a href="http://www.ognisco.com">Ognisco</a>
</div>

</body>
</html>